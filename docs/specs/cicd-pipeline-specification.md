# CI/CD„Éë„Ç§„Éó„É©„Ç§„É≥‰ªïÊßòÊõ∏

## Ê¶ÇË¶Å

Êú¨‰ªïÊßòÊõ∏„Åß„ÅØ„ÄÅ2Áí∞Â¢ÉÊßãÊàêÔºà„É≠„Éº„Ç´„É´ÈñãÁô∫ + Azure„Éá„É¢Áí∞Â¢ÉÔºâ„Å´ÂØæÂøú„Åó„ÅüCI/CD„Éë„Ç§„Éó„É©„Ç§„É≥„ÇíÂÆöÁæ©„Åó„Åæ„Åô„ÄÇ

## Áí∞Â¢ÉÊßãÊàê

### „É≠„Éº„Ç´„É´ÈñãÁô∫Áí∞Â¢É
- ÈñãÁô∫ËÄÖ„ÅÆÊâãÂãï„Éá„Éó„É≠„Ç§„É°„É≥„Éà
- Container Apps„Å∏„ÅÆÁõ¥Êé•Êé•Á∂ö
- „Éá„Éê„ÉÉ„Ç∞„Éª„ÉÜ„Çπ„ÉàÂÆüË°å

### Azure„Éá„É¢Áí∞Â¢É
- GitHub Actions„Å´„Çà„ÇãCI/CDËá™ÂãïÂåñ
- Static Web Apps + Container Apps Linked Backend
- Infrastructure as Code (Terraform)

## CI/CD„ÉØ„Éº„ÇØ„Éï„É≠„Éº

### „ÉØ„Éº„ÇØ„Éï„É≠„ÉºÂÆüË°åÊñπÂºè

#### Ëá™ÂãïÂÆüË°å
- **Push to main**: „Ç§„É≥„Éï„É©Â§âÊõ¥ÊôÇ„ÅÆËá™Âãï„Éá„Éó„É≠„Ç§
- **Pull Request**: Terraform Plan„ÅÆËá™ÂãïÂÆüË°å„Å®„Ç≥„É°„É≥„ÉàË°®Á§∫
- **Workflow Chain**: Infrastructure ‚Üí Backend ‚Üí Frontend ‚Üí Integration

#### ÊâãÂãïÂÆüË°åÔºàWorkflow DispatchÔºâ
GitHub Actions„ÅÆUI„Åã„ÇâÊâãÂãï„Åß„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÂÆüË°åÂèØËÉΩÔºö

**Infrastructure Workflow**:
- **Action**: `plan` / `apply` / `destroy`
- **Environment**: `demo`
- **Destroy Confirmation**: Á†¥Â£äÁöÑÊìç‰ΩúÊôÇ„ÅÆÁ¢∫Ë™ç„Éï„Ç£„Éº„É´„Éâ

**‰ΩøÁî®‰æã**:
1. **Ë®àÁîªÁ¢∫Ë™ç**: `Action: plan` ‚Üí TerraformË®àÁîª„Çí„Ç¢„Éº„ÉÜ„Ç£„Éï„Ç°„ÇØ„Éà„Å®„Åó„Å¶‰øùÂ≠ò
2. **ÊâãÂãï„Éá„Éó„É≠„Ç§**: `Action: apply` ‚Üí „Ç§„É≥„Éï„É©„ÇíÂç≥Â∫ß„Å´„Éá„Éó„É≠„Ç§
3. **Áí∞Â¢ÉÂâäÈô§**: `Action: destroy` + `confirm_destroy: CONFIRM` ‚Üí Áí∞Â¢É„ÇíÂÆåÂÖ®ÂâäÈô§

### 1. „Ç§„É≥„Éï„É©„Çπ„Éà„É©„ÇØ„ÉÅ„É£„Éá„Éó„É≠„Ç§

#### `.github/workflows/infrastructure.yml`
```yaml
name: Deploy Infrastructure

on:
  push:
    branches: [main]
    paths: ['infra/**', '.github/workflows/infrastructure.yml']
  pull_request:
    branches: [main]
    paths: ['infra/**']
  workflow_dispatch:
    inputs:
      action:
        description: 'Terraform Action'
        required: true
        default: 'plan'
        type: choice
        options:
        - plan
        - apply
        - destroy
      environment:
        description: 'Target Environment'
        required: true
        default: 'demo'
        type: choice
        options:
        - demo
      confirm_destroy:
        description: 'Type "CONFIRM" to proceed with destroy'
        required: false
        type: string

env:
  ARM_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}
  ARM_CLIENT_SECRET: ${{ secrets.AZURE_CLIENT_SECRET }}
  ARM_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
  ARM_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}

jobs:
  terraform:
    name: 'Terraform ${{ github.event.inputs.action || 'Deploy' }}'
    runs-on: ubuntu-latest
    environment: ${{ github.event.inputs.environment || 'demo' }}
    
    defaults:
      run:
        shell: bash
        working-directory: ./infra

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Terraform
      uses: hashicorp/setup-terraform@v3
      with:
        terraform_version: 1.5.0

    - name: Terraform Format Check
      run: terraform fmt -check

    - name: Terraform Init
      run: terraform init

    - name: Terraform Validate
      run: terraform validate

    - name: Terraform Plan
      id: plan
      run: |
        terraform plan -var-file="environments/${{ github.event.inputs.environment || 'demo' }}.tfvars" -no-color -out=tfplan
        terraform show -no-color tfplan
      continue-on-error: false

    - name: Terraform Apply
      if: |
        (github.ref == 'refs/heads/main' && github.event_name == 'push') ||
        (github.event.inputs.action == 'apply' && github.event_name == 'workflow_dispatch')
      run: |
        echo "üöÄ Applying Terraform changes..."
        terraform apply -auto-approve tfplan

    - name: Confirm Destroy
      if: github.event.inputs.action == 'destroy'
      run: |
        if [ "${{ github.event.inputs.confirm_destroy }}" != "CONFIRM" ]; then
          echo "‚ùå Destroy action requires 'CONFIRM' in the confirm_destroy input"
          exit 1
        fi
        echo "‚ö†Ô∏è  Proceeding with infrastructure destruction..."

    - name: Terraform Destroy
      if: github.event.inputs.action == 'destroy' && github.event.inputs.confirm_destroy == 'CONFIRM'
      run: |
        echo "üóëÔ∏è Destroying infrastructure..."
        terraform destroy -var-file="environments/${{ github.event.inputs.environment || 'demo' }}.tfvars" -auto-approve

    - name: Output Important Values
      if: |
        (github.ref == 'refs/heads/main' && github.event_name == 'push') ||
        (github.event.inputs.action == 'apply' && github.event_name == 'workflow_dispatch')
      run: |
        echo "üìã Terraform Outputs:"
        echo "CONTAINER_APPS_FQDN=$(terraform output -raw container_apps_fqdn)" >> $GITHUB_ENV
        echo "STATIC_WEB_APP_HOSTNAME=$(terraform output -raw static_web_app_hostname)" >> $GITHUB_ENV
        echo "COSMOS_DB_ENDPOINT=$(terraform output -raw cosmos_db_endpoint)" >> $GITHUB_ENV
        
        # Âá∫ÂäõÂÄ§„Çí„Çµ„Éû„É™„Éº„Å´Ë°®Á§∫
        echo "## üéØ Infrastructure Deployment Results" >> $GITHUB_STEP_SUMMARY
        echo "| Resource | Value |" >> $GITHUB_STEP_SUMMARY
        echo "|----------|-------|" >> $GITHUB_STEP_SUMMARY
        echo "| Container Apps FQDN | $(terraform output -raw container_apps_fqdn) |" >> $GITHUB_STEP_SUMMARY
        echo "| Static Web App Hostname | $(terraform output -raw static_web_app_hostname) |" >> $GITHUB_STEP_SUMMARY
        echo "| Cosmos DB Endpoint | $(terraform output -raw cosmos_db_endpoint) |" >> $GITHUB_STEP_SUMMARY

    - name: Upload Terraform Plan
      if: github.event.inputs.action == 'plan' || github.event_name == 'pull_request'
      uses: actions/upload-artifact@v4
      with:
        name: terraform-plan-${{ github.event.inputs.environment || 'demo' }}
        path: infra/tfplan
        retention-days: 30

    - name: Comment PR with Plan
      if: github.event_name == 'pull_request'
      uses: actions/github-script@v7
      with:
        script: |
          const fs = require('fs');
          const { execSync } = require('child_process');
          
          // Terraform plan„ÅÆÁµêÊûú„ÇíÂèñÂæó
          const planOutput = execSync('cd infra && terraform show -no-color tfplan', { encoding: 'utf-8' });
          
          const comment = `## üèóÔ∏è Terraform Plan Results
          
          <details>
          <summary>üìã Click to expand plan output</summary>
          
          \`\`\`hcl
          ${planOutput}
          \`\`\`
          </details>
          
          **Action Required:** Review the plan and merge to apply changes automatically.
          `;
          
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          });
```

### 2. „Éê„ÉÉ„ÇØ„Ç®„É≥„ÉâAPI„Éá„Éó„É≠„Ç§

#### `.github/workflows/backend.yml`
```yaml
name: Deploy Backend API

on:
  push:
    branches: [main]
    paths: ['backend/**', '.github/workflows/backend.yml']
  pull_request:
    branches: [main]
    paths: ['backend/**']
  workflow_dispatch:

env:
  REGISTRY_NAME: ${{ secrets.AZURE_REGISTRY_NAME }}
  IMAGE_NAME: todo-backend
  
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    environment: demo
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Set up Python 3.13
      uses: actions/setup-python@v4
      with:
        python-version: '3.13'

    - name: Install uv
      run: |
        curl -LsSf https://astral.sh/uv/install.sh | sh
        echo "$HOME/.cargo/bin" >> $GITHUB_PATH

    - name: Install dependencies
      working-directory: ./backend
      run: |
        uv sync --frozen

    - name: Run tests
      working-directory: ./backend
      run: |
        uv run pytest tests/ -v --cov=app --cov-report=xml

    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3
      with:
        file: ./backend/coverage.xml
        flags: backend
        name: backend-coverage

    - name: Log in to Azure Container Registry
      uses: azure/docker-login@v1
      with:
        login-server: ${{ secrets.AZURE_REGISTRY_NAME }}.azurecr.io
        username: ${{ secrets.AZURE_REGISTRY_USERNAME }}
        password: ${{ secrets.AZURE_REGISTRY_PASSWORD }}

    - name: Build and push Docker image
      working-directory: ./backend
      run: |
        docker build -t ${{ secrets.AZURE_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }} .
        docker build -t ${{ secrets.AZURE_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:latest .
        docker push ${{ secrets.AZURE_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }}
        docker push ${{ secrets.AZURE_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:latest

    - name: Deploy to Container Apps
      uses: azure/container-apps-deploy-action@v1
      with:
        acrName: ${{ secrets.AZURE_REGISTRY_NAME }}
        containerAppName: ${{ secrets.AZURE_CONTAINER_APP_NAME }}
        resourceGroup: ${{ secrets.AZURE_RESOURCE_GROUP }}
        imageToDeploy: ${{ secrets.AZURE_REGISTRY_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }}
        environmentVariables: |
          AZURE_COSMOS_CONNECTION_STRING=${{ secrets.AZURE_COSMOS_CONNECTION_STRING }}
          APPLICATIONINSIGHTS_CONNECTION_STRING=${{ secrets.APPLICATIONINSIGHTS_CONNECTION_STRING }}
          ENVIRONMENT=demo
```

### 3. „Éï„É≠„É≥„Éà„Ç®„É≥„Éâ„Éá„Éó„É≠„Ç§

#### `.github/workflows/frontend.yml`
```yaml
name: Deploy Frontend (Static Web Apps)

on:
  push:
    branches: [main]
    paths: ['frontend/**', '.github/workflows/frontend.yml']
  pull_request:
    branches: [main]
    paths: ['frontend/**']
  workflow_dispatch:

jobs:
  build_and_deploy:
    if: github.event_name == 'push' || (github.event_name == 'pull_request' && github.event.action != 'closed')
    runs-on: ubuntu-latest
    name: Build and Deploy
    environment: demo
    
    steps:
    - uses: actions/checkout@v4
      with:
        submodules: true

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json

    - name: Install dependencies
      working-directory: ./frontend
      run: npm ci

    - name: Run tests
      working-directory: ./frontend
      run: npm run test:ci

    - name: Run E2E tests
      working-directory: ./frontend
      run: |
        npm run build:test
        npm run test:e2e:ci

    - name: Build
      working-directory: ./frontend
      run: npm run build
      env:
        VITE_APP_VERSION: ${{ github.sha }}
        VITE_ENVIRONMENT: demo
        APPLICATIONINSIGHTS_CONNECTION_STRING: ${{ secrets.APPLICATIONINSIGHTS_CONNECTION_STRING }}

    - name: Deploy to Static Web Apps
      uses: Azure/static-web-apps-deploy@v1
      with:
        azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN }}
        repo_token: ${{ secrets.GITHUB_TOKEN }}
        action: "upload"
        app_location: "frontend"
        api_location: ""  # Linked Backend„Çí‰ΩøÁî®„Åô„Çã„Åü„ÇÅAPI location„ÅØÁ©∫
        output_location: "dist"
        app_build_command: "npm run build"

  close_pull_request:
    if: github.event_name == 'pull_request' && github.event.action == 'closed'
    runs-on: ubuntu-latest
    name: Close Pull Request
    steps:
    - name: Close Pull Request
      uses: Azure/static-web-apps-deploy@v1
      with:
        azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN }}
        action: "close"
```

### 4. Áµ±Âêà„ÉÜ„Çπ„Éà„Éª„Éá„Éó„É≠„Ç§

#### `.github/workflows/integration.yml`
```yaml
name: Integration Tests and Deployment

on:
  workflow_run:
    workflows: ["Deploy Infrastructure", "Deploy Backend API", "Deploy Frontend (Static Web Apps)"]
    types: [completed]
    branches: [main]
  workflow_dispatch:

jobs:
  integration-tests:
    runs-on: ubuntu-latest
    environment: demo
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Install dependencies
      run: npm ci
      working-directory: ./tests/integration

    - name: Wait for deployment
      run: |
        echo "Waiting for services to be ready..."
        sleep 60

    - name: Run Integration Tests
      working-directory: ./tests/integration
      env:
        BASE_URL: https://${{ secrets.STATIC_WEB_APP_HOSTNAME }}
        API_BASE_URL: https://${{ secrets.STATIC_WEB_APP_HOSTNAME }}/api
      run: |
        npm run test:integration

    - name: Run Load Tests
      uses: azure/load-testing@v1
      with:
        loadTestConfigFile: 'tests/load/load-test-config.yaml'
        loadTestResource: ${{ secrets.AZURE_LOAD_TESTING_RESOURCE }}
        resourceGroup: ${{ secrets.AZURE_RESOURCE_GROUP }}
        env: |
          webapp.url=https://${{ secrets.STATIC_WEB_APP_HOSTNAME }}

  health-check:
    runs-on: ubuntu-latest
    needs: integration-tests
    steps:
    - name: Application Health Check
      run: |
        # „Éò„É´„Çπ„ÉÅ„Çß„ÉÉ„ÇØ„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà„ÅÆÁ¢∫Ë™ç
        response=$(curl -s -o /dev/null -w "%{http_code}" https://${{ secrets.STATIC_WEB_APP_HOSTNAME }}/api/health)
        if [ $response -eq 200 ]; then
          echo "‚úÖ Application is healthy"
        else
          echo "‚ùå Application health check failed with status: $response"
          exit 1
        fi

    - name: Memory Stress Test
      run: |
        # „É©„É≥„ÉÄ„É†„É°„É¢„É™Ê∂àË≤ªÊ©üËÉΩ„ÅÆ„ÉÜ„Çπ„Éà
        echo "Testing random memory consumption feature..."
        for i in {1..5}; do
          echo "Test $i/5"
          response=$(curl -s -X POST https://${{ secrets.STATIC_WEB_APP_HOSTNAME }}/api/todos \
            -H "Content-Type: application/json" \
            -d '{"title":"Test Memory Stress '$i'","description":"Testing random memory consumption"}')
          echo "Response: $response"
          sleep 2
        done

  deployment-notification:
    runs-on: ubuntu-latest
    needs: [integration-tests, health-check]
    if: always()
    steps:
    - name: Notify deployment status
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        channel: '#deployments'
        text: |
          üöÄ Todo App Demo Deployment
          üìç Environment: Azure Demo
          üìä Status: ${{ job.status }}
          üîó URL: https://${{ secrets.STATIC_WEB_APP_HOSTNAME }}
          üêô Commit: ${{ github.sha }}
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
```

## ÂøÖË¶Å„Å™GitHub Secrets

### „Ç∑„Éº„ÇØ„É¨„ÉÉ„ÉàÁÆ°ÁêÜÊñπÈáù
- **Environment Secrets (Êé®Â•®)**: `demo`Áí∞Â¢É„Å´ÂÆöÁæ©„Åï„Çå„Åü„Ç∑„Éº„ÇØ„É¨„ÉÉ„Éà
- **Repository Secrets**: „É™„Éù„Ç∏„Éà„É™ÂÖ®‰Ωì„ÅßÂÖ±Êúâ„Åï„Çå„Çã„Ç∑„Éº„ÇØ„É¨„ÉÉ„Éà
- **Priority**: Environment Secrets > Repository Secrets

### „Ç∑„Éº„ÇØ„É¨„ÉÉ„ÉàË®≠ÂÆöÂ†¥ÊâÄ

#### GitHubÁí∞Â¢É„Åß„ÅÆË®≠ÂÆöÊñπÊ≥ï
1. **Environment SecretsÔºàÊé®Â•®Ôºâ**:
   - „É™„Éù„Ç∏„Éà„É™ ‚Üí Settings ‚Üí Environments ‚Üí `demo` ‚Üí Environment secrets
   - „Çà„ÇäÂÆâÂÖ®ÔºàÁí∞Â¢É‰øùË≠∑„É´„Éº„É´ÈÅ©Áî®Ôºâ
   - Áí∞Â¢ÉÂà•„ÅÆÂÄ§Ë®≠ÂÆöÂèØËÉΩ

2. **Repository SecretsÔºà‰ª£ÊõøÔºâ**:
   - „É™„Éù„Ç∏„Éà„É™ ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí Repository secrets
   - „É™„Éù„Ç∏„Éà„É™ÂÖ®‰Ωì„ÅßÂÖ±Êúâ
   - „Ç∑„É≥„Éó„É´„Å™ÁÆ°ÁêÜ

### AzureË™çË®ºÔºàEnvironmentÊé®Â•®Ôºâ
```
AZURE_CLIENT_ID          # Service Principal„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ID
AZURE_CLIENT_SECRET      # Service Principal„ÅÆ„Ç∑„Éº„ÇØ„É¨„ÉÉ„Éà  
AZURE_SUBSCRIPTION_ID    # Azure„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥ID
AZURE_TENANT_ID          # Azure AD„ÉÜ„Éä„É≥„ÉàID
```

### Azure„É™„ÇΩ„Éº„ÇπÔºàEnvironmentÊé®Â•®Ôºâ
```
AZURE_RESOURCE_GROUP            # „Éá„Éó„É≠„Ç§ÂÖà„É™„ÇΩ„Éº„Çπ„Ç∞„É´„Éº„ÉóÂêç
AZURE_REGISTRY_NAME             # Container RegistryÂêç
AZURE_REGISTRY_USERNAME         # Container RegistryË™çË®ºÁî®„É¶„Éº„Ç∂„ÉºÂêç
AZURE_REGISTRY_PASSWORD         # Container RegistryË™çË®ºÁî®„Éë„Çπ„ÉØ„Éº„Éâ
AZURE_CONTAINER_APP_NAME        # Container AppsÂêç
AZURE_STATIC_WEB_APPS_API_TOKEN # Static Web Apps API„Éà„Éº„ÇØ„É≥
AZURE_LOAD_TESTING_RESOURCE     # Load Testing „É™„ÇΩ„Éº„ÇπÂêç
```

### Êé•Á∂öÊñáÂ≠óÂàóÔºàEnvironmentÊé®Â•®Ôºâ
```
AZURE_COSMOS_CONNECTION_STRING      # Cosmos DBÊé•Á∂öÊñáÂ≠óÂàó
APPLICATIONINSIGHTS_CONNECTION_STRING # Application InsightsÊé•Á∂öÊñáÂ≠óÂàó
```

### Static Web AppsÔºàEnvironmentÊé®Â•®Ôºâ
```
STATIC_WEB_APP_HOSTNAME  # Static Web Apps„ÅÆ„Éõ„Çπ„ÉàÂêçÔºà‰æã: myapp.azurestaticapps.netÔºâ
```

### ÈÄöÁü•ÔºàRepositoryÂèØÔºâ
```
SLACK_WEBHOOK_URL        # SlackÈÄöÁü•Áî®WebhookURLÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ
```

## ÊâãÂãïÂÆüË°åÔºàWorkflow DispatchÔºâ„ÅÆ‰ΩøÁî®ÊñπÊ≥ï

### 0. ‰∫ãÂâçÊ∫ñÂÇôÔºöEnvironment SecretsË®≠ÂÆö

#### demoÁí∞Â¢É„ÅÆ‰ΩúÊàê„Å®Ë®≠ÂÆö
1. **GitHub Environment‰ΩúÊàê**:
   - „É™„Éù„Ç∏„Éà„É™ ‚Üí Settings ‚Üí Environments
   - „ÄåNew environment„Äç‚Üí ÂêçÂâç: `demo`
   - „ÄåConfigure environment„Äç

2. **Environment ProtectionË®≠ÂÆö**ÔºàÊé®Â•®Ôºâ:
   ```
   ‚úÖ Required reviewers: „É™„Éù„Ç∏„Éà„É™ÁÆ°ÁêÜËÄÖ
   ‚úÖ Wait timer: 0 minutes  
   ‚úÖ Deployment branches: Selected branches ‚Üí main
   ```

3. **Environment SecretsË®≠ÂÆö**:
   - Environment secrets ‚Üí „ÄåAdd secret„Äç
   - ‰ª•‰∏ã„ÅÆ„Ç∑„Éº„ÇØ„É¨„ÉÉ„Éà„ÇíË®≠ÂÆö:

#### ÂøÖÈ†àEnvironment Secrets‰∏ÄË¶ß
```bash
# AzureË™çË®º
AZURE_CLIENT_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
AZURE_CLIENT_SECRET=your-service-principal-secret
AZURE_SUBSCRIPTION_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  
AZURE_TENANT_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# Azure„É™„ÇΩ„Éº„Çπ
AZURE_RESOURCE_GROUP=rg-todo-demo
AZURE_REGISTRY_NAME=acrtododemo
AZURE_REGISTRY_USERNAME=acrtododemo
AZURE_REGISTRY_PASSWORD=your-acr-password
AZURE_CONTAINER_APP_NAME=ca-todo-backend-demo
AZURE_STATIC_WEB_APPS_API_TOKEN=your-swa-api-token
AZURE_LOAD_TESTING_RESOURCE=lt-todo-demo

# Êé•Á∂öÊñáÂ≠óÂàó
AZURE_COSMOS_CONNECTION_STRING=AccountEndpoint=https://...
APPLICATIONINSIGHTS_CONNECTION_STRING=InstrumentationKey=...

# Static Web Apps
STATIC_WEB_APP_HOSTNAME=myapp.azurestaticapps.net

# ÈÄöÁü•Ôºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/...
```

### 1. InfrastructureÊâãÂãïÂÆüË°å
GitHub Actions„ÅÆUI„Åß‰ª•‰∏ã„ÅÆÊâãÈ†Ü„ÅßÂÆüË°åÔºö

1. **„É™„Éù„Ç∏„Éà„É™„ÅÆActions „Çø„Éñ**„Å´ÁßªÂãï
2. **"Deploy Infrastructure"** „ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÈÅ∏Êäû
3. **"Run workflow"** „Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ
4. **„Éë„É©„É°„Éº„Çø„ÇíË®≠ÂÆö**:
   - `Action`: `plan` (Á¢∫Ë™ç„ÅÆ„Åø) / `apply` (ÂÆüË°å) / `destroy` (ÂâäÈô§)
   - `Environment`: `demo`
   - `Confirm Destroy`: ÂâäÈô§ÊôÇ„ÅÆ„Åø `CONFIRM` „Å®ÂÖ•Âäõ

### 2. ÂÆüË°å‰æã

#### „Ç§„É≥„Éï„É©Ë®àÁîªÁ¢∫Ë™ç
```
Action: plan
Environment: demo
Confirm Destroy: (Á©∫ÁôΩ)
```
‚Üí Terraform plan„ÇíÂÆüË°å„Åó„ÄÅÂ§âÊõ¥ÂÜÖÂÆπ„Çí„Ç¢„Éº„ÉÜ„Ç£„Éï„Ç°„ÇØ„Éà„Å®„Åó„Å¶‰øùÂ≠ò

#### „Ç§„É≥„Éï„É©Âç≥Â∫ß„Éá„Éó„É≠„Ç§
```
Action: apply
Environment: demo
Confirm Destroy: (Á©∫ÁôΩ)
```
‚Üí „Ç§„É≥„Éï„É©„ÇíÂç≥Â∫ß„Å´„Éá„Éó„É≠„Ç§„Åó„ÄÅÂá∫ÂäõÂÄ§„ÇíGitHub Summary„Å´Ë°®Á§∫

#### „Ç§„É≥„Éï„É©ÂÆåÂÖ®ÂâäÈô§
```
Action: destroy
Environment: demo
Confirm Destroy: CONFIRM
```
‚Üí **‚ö†Ô∏èË≠¶Âëä**: „Åô„Åπ„Å¶„ÅÆ„É™„ÇΩ„Éº„Çπ„ÇíÂâäÈô§ÔºàÂèñ„ÇäÊ∂à„Åó‰∏çÂèØÔºâ

### 3. ÂÆâÂÖ®Ê©üËÉΩ

#### Destroy‰øùË≠∑
- `destroy`„Ç¢„ÇØ„Ç∑„Éß„É≥„ÅØ`confirm_destroy: CONFIRM`„ÅåÂøÖË¶Å
- ÂÖ•ÂäõÂÄ§„ÅåÊ≠£Á¢∫„Åß„Å™„ÅÑÂ†¥Âêà„ÅØ„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÂ§±Êïó

#### PlanÂá∫Âäõ
- Terraform plan„ÅÆÁµêÊûú„ÇíGitHub Step Summary„Å´Ë°®Á§∫
- PR„Ç≥„É°„É≥„Éà„Å´Ë®àÁîªÂÜÖÂÆπ„ÇíËá™ÂãïÊäïÁ®ø
- PlanÁµêÊûú„Çí„Ç¢„Éº„ÉÜ„Ç£„Éï„Ç°„ÇØ„Éà„Å®„Åó„Å¶30Êó•Èñì‰øùÂ≠ò

#### Áí∞Â¢É‰øùË≠∑
- `environment: demo`„Å´„Çà„ÇãÊâøË™ç„É´„Éº„É´ÈÅ©Áî®
- GitHub Environments„ÅÆprotection rulesÊúâÂäπ

### 4. „Ç∑„Éº„ÇØ„É¨„ÉÉ„ÉàÂèñÂæó„ÅÆ‰ªïÁµÑ„Åø

#### ÁèæÂú®„ÅÆÂÆüË£Ö„Åß„ÅÆÂãï‰Ωú
```yaml
jobs:
  terraform:
    environment: demo  # demoÁí∞Â¢É„ÇíÊåáÂÆö
    # ‚Üì „Ç∑„Éº„ÇØ„É¨„ÉÉ„ÉàÂèñÂæó„ÅÆÂÑ™ÂÖàÈ†Ü‰Ωç
    # 1. demoÁí∞Â¢É„ÅÆEnvironment Secrets
    # 2. Repository SecretsÔºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ
```

#### „Ç∑„Éº„ÇØ„É¨„ÉÉ„ÉàÂèñÂæó‰æã
```yaml
# Environment SecretÂÑ™ÂÖà„ÅßÂèñÂæó
env:
  ARM_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}
  # ‚Üë ‰ª•‰∏ã„ÅÆÈ†ÜÂ∫è„ÅßÊ§úÁ¥¢:
  # 1. demoÁí∞Â¢É„ÅÆAZURE_CLIENT_ID
  # 2. Repository level„ÅÆAZURE_CLIENT_ID
```

#### Êé®Â•®Ë®≠ÂÆö„Éë„Çø„Éº„É≥
```yaml
# „Éë„Çø„Éº„É≥1: Environment SecretsÔºàÊé®Â•®Ôºâ
environment: demo
env:
  ARM_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}  # demoÁí∞Â¢É„Åã„ÇâÂèñÂæó

# „Éë„Çø„Éº„É≥2: Repository SecretsÔºà„Ç∑„É≥„Éó„É´Ôºâ
# environment: demo „ÇíÂâäÈô§
env:
  ARM_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}  # Repository„Åã„ÇâÂèñÂæó
```

## „Éá„Éó„É≠„Ç§„Éï„É≠„Éº

### 1. Ëá™Âãï„Éá„Éó„É≠„Ç§„Éï„É≠„ÉºÔºàInfrastructure FirstÔºâ
```mermaid
graph TD
    A[Push to main] --> B[Infrastructure Workflow]
    B --> C[Terraform Plan & Apply]
    C --> D[Output Azure Resources]
    D --> E[Backend Workflow Triggered]
    E --> F[Frontend Workflow Triggered]
    F --> G[Integration Tests]
    G --> H[Health Checks]
```

### 2. ÊâãÂãï„Éá„Éó„É≠„Ç§„Éï„É≠„ÉºÔºàWorkflow DispatchÔºâ
```mermaid
graph TD
    A[GitHub Actions UI] --> B[Select Infrastructure Workflow]
    B --> C[Choose Action: plan/apply/destroy]
    C --> D[Run Workflow]
    D --> E{Action Type}
    E -->|plan| F[Terraform Plan Only]
    E -->|apply| G[Terraform Apply]
    E -->|destroy| H[Confirm DESTROY]
    F --> I[Upload Plan Artifact]
    G --> J[Deploy Infrastructure]
    H --> K[Delete All Resources]
    J --> L[Output Resource URLs]
    I --> M[Review Plan Results]
```

### 3. Ê∑∑Âêà„Éá„Éó„É≠„Ç§„Éï„É≠„Éº
```mermaid
graph TD
    A[Manual Infrastructure Deploy] --> B[Automatic Backend/Frontend Deploy]
    B --> C[Triggered by main branch push]
    C --> D[Backend & Frontend Workflows]
    D --> E[Integration Tests]
```

### 4. ÈöúÂÆ≥ÊôÇ„ÅÆËá™Âãï„É≠„Éº„É´„Éê„ÉÉ„ÇØ
```yaml
- name: Rollback on failure
  if: failure()
  run: |
    # Ââç„ÅÆ„Éê„Éº„Ç∏„Éß„É≥„Å∏„ÅÆ„É≠„Éº„É´„Éê„ÉÉ„ÇØ
    az containerapp revision set-active \
      --name ${{ secrets.AZURE_CONTAINER_APP_NAME }} \
      --resource-group ${{ secrets.AZURE_RESOURCE_GROUP }} \
      --revision-name previous-stable
```

## Áõ£Ë¶ñ„Éª„Ç¢„É©„Éº„ÉàÁµ±Âêà

### Application InsightsÈÄ£Êê∫
- „Éá„Éó„É≠„Ç§„É°„É≥„ÉàËøΩË∑°
- „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„É°„Éà„É™„ÇØ„Çπ
- „Ç®„É©„ÉºÁõ£Ë¶ñ
- „Ç´„Çπ„Çø„É†„Ç§„Éô„É≥„ÉàËøΩË∑°

### GitHub Environments
- **demoÁí∞Â¢É**: Êú¨Áï™Áõ∏ÂΩì„ÅÆ‰øùË≠∑„É´„Éº„É´
- „É¨„Éì„É•„ÉºÂøÖË¶Å„Å™Â§âÊõ¥„ÅÆÂà∂Âæ°
- Áí∞Â¢ÉÂà•„Ç∑„Éº„ÇØ„É¨„ÉÉ„ÉàÁÆ°ÁêÜ

## „Ç≥„Çπ„ÉàÊúÄÈÅ©Âåñ

### ÂäπÁéáÁöÑ„Å™CI/CD
- Â§âÊõ¥„ÅÆ„ÅÇ„Çã„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„ÅÆ„Åø„Éì„É´„Éâ„Éª„Éá„Éó„É≠„Ç§
- „Éë„É©„É¨„É´ÂÆüË°å„Å´„Çà„Çã„Éì„É´„ÉâÊôÇÈñìÁü≠Á∏Æ
- „Ç≠„É£„ÉÉ„Ç∑„É•Ê¥ªÁî®„Å´„Çà„Çã„É™„ÇΩ„Éº„ÇπÂâäÊ∏õ

### „É™„ÇΩ„Éº„ÇπÁÆ°ÁêÜ
- ‰ΩøÁî®„Åó„Å¶„ÅÑ„Å™„ÅÑPR„Éñ„É©„É≥„ÉÅ„ÅÆËá™Âãï„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
- Â§úÈñì„ÉªÈÄ±Êú´„ÅÆ„É™„ÇΩ„Éº„Çπ„Çπ„Ç±„Éº„É´„ÉÄ„Ç¶„É≥Ôºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ

## „Çª„Ç≠„É•„É™„ÉÜ„Ç£

### „Ç∑„Éº„ÇØ„É¨„ÉÉ„ÉàÁÆ°ÁêÜ
- GitHub Secrets„Å´„Çà„ÇãAzureË™çË®ºÊÉÖÂ†±ÁÆ°ÁêÜ
- Áí∞Â¢ÉÂà•„ÅÆ„Ç∑„Éº„ÇØ„É¨„ÉÉ„ÉàÂàÜÈõ¢
- ÊúÄÂ∞èÊ®©Èôê„ÅÆÂéüÂâá

### Workflow Dispatch „Çª„Ç≠„É•„É™„ÉÜ„Ç£
- **Environment Protection**: `demo`Áí∞Â¢É„Åß„ÅÆÊâøË™ç„É´„Éº„É´
- **Destroy Protection**: ÂâäÈô§ÊôÇ„ÅÆÊòéÁ§∫ÁöÑÁ¢∫Ë™ç„Éï„Ç£„Éº„É´„Éâ
- **Branch Protection**: main „Éñ„É©„É≥„ÉÅ„Åã„Çâ„ÅÆÂÆüË°åÂà∂Èôê
- **Audit Log**: GitHub ActionsÂÆüË°åÂ±•Ê≠¥„ÅÆÂÆåÂÖ®Ë®òÈå≤

### „Ç¢„ÇØ„Çª„ÇπÂà∂Âæ°
- **Repository Admin**: „Åô„Åπ„Å¶„ÅÆworkflow_dispatchÂÆüË°åÂèØËÉΩ
- **Write Permission**: Infrastructure‰ª•Â§ñ„ÅÆ„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÂÆüË°åÂèØËÉΩ
- **Destroy Action**: Repository Admin + ÊòéÁ§∫ÁöÑÁ¢∫Ë™ç„ÅÆ„Åø

### „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Éô„Çπ„Éà„Éó„É©„ÇØ„ÉÜ„Ç£„Çπ
```yaml
# workflow_dispatch„ÅÆ„Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë®≠ÂÆö‰æã
on:
  workflow_dispatch:
    inputs:
      confirm_destroy:
        description: 'Type "CONFIRM" to proceed with destroy'
        required: false
        type: string

jobs:
  terraform:
    environment: demo  # Environment protectionÊúâÂäπ
    if: |
      github.ref == 'refs/heads/main' &&
      (github.actor == 'admin' || contains(github.actor, 'approved-user'))
```

### „Ç≥„Éº„Éâ„Çπ„Ç≠„É£„É≥
- ‰æùÂ≠òÈñ¢‰øÇ„ÅÆËÑÜÂº±ÊÄß„Çπ„Ç≠„É£„É≥
- „Ç≥„Éº„ÉâÂìÅË≥™„ÉÅ„Çß„ÉÉ„ÇØ
- Container „Ç§„É°„Éº„Ç∏„Çπ„Ç≠„É£„É≥
- TerraformË®≠ÂÆö„Éï„Ç°„Ç§„É´„ÅÆ„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Çπ„Ç≠„É£„É≥

## Èñ¢ÈÄ£„Éâ„Ç≠„É•„É°„É≥„Éà
- [„Ç§„É≥„Éï„É©„Çπ„Éà„É©„ÇØ„ÉÅ„É£‰ªïÊßòÊõ∏](./infrastructure-specification.md)
- [„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ‰ªïÊßòÊõ∏](./backend-specification.md)
- [„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ‰ªïÊßòÊõ∏](./frontend-specification.md)
